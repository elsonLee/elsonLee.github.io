<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>ä¸­å¿ƒæé™å®šç†é€šç”¨æ¨¡æ‹Ÿå™¨ - å¤šåˆ†å¸ƒæ¨¡æ‹Ÿ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #10B981; /* Emerald */
            --bg: #0F172A;
            --card: #1E293B;
            --text: #F8FAFC;
            --text-sub: #94A3B8;
        }

        body {
            font-family: system-ui;
            background: var(--bg);
            color: var(--text);
            padding: 20px;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .container {
            width: 100%;
            max-width: 1200px;
        }

        .card {
            background: var(--card);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.3);
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .canvas-container {
            position: relative;
            width: 100%;
        }

        canvas {
            width: 100% !important;
            border-radius: 8px;
        }

        .controls {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        button {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.2s;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-reset {
            background: #475569;
            color: white;
        }

        select, input[type="range"] {
            padding: 10px;
            border-radius: 8px;
            border: 2px solid #475569;
            background: var(--card);
            color: var(--text);
            font-size: 14px;
            cursor: pointer;
        }

        select:hover, input[type="range"]:hover {
            border-color: var(--primary);
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 15px;
        }

        .control-label {
            color: var(--text-sub);
            font-size: 0.85rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        h1 {
            margin-bottom: 10px;
        }

        .desc {
            color: var(--text-sub);
            text-align: center;
            max-width: 800px;
            margin: 0 auto 30px;
            line-height: 1.6;
        }

        h2 {
            color: var(--primary);
            margin-top: 0;
            border-bottom: 2px solid var(--primary);
            padding-bottom: 10px;
        }

        h3 {
            margin-top: 0;
            font-size: 1.1rem;
            margin-bottom: 15px;
        }

        .stats-box {
            background: #334155;
            padding: 1rem;
            border-radius: 8px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .stat-item small {
            display: block;
            color: var(--text-sub);
            font-size: 0.75rem;
            margin-bottom: 2px;
        }

        .stat-item strong {
            font-size: 1.25rem;
            color: var(--text);
        }

        .value-display {
            float: right;
            color: var(--primary);
            font-family: 'Courier New', monospace;
            font-weight: bold;
        }

        .help-text {
            font-size: 0.75rem;
            color: var(--text-sub);
            margin-top: 4px;
            line-height: 1.4;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>ğŸ“ˆ ä¸­å¿ƒæé™å®šç† (CLT) é€šç”¨æ¨¡æ‹Ÿå™¨</h1>
        <p class="desc">
            é€‰æ‹©ä¸åŒçš„åŸå§‹åˆ†å¸ƒï¼Œè§è¯å®ƒä»¬å¦‚ä½•ç»Ÿä¸€å½’äºæ­£æ€åˆ†å¸ƒã€‚<br>
            æ— è®ºåŸå§‹åˆ†å¸ƒæ˜¯ä»€ä¹ˆå½¢æ€ï¼Œåªè¦æ ·æœ¬é‡è¶³å¤Ÿå¤§ï¼Œæ ·æœ¬å‡å€¼çš„åˆ†å¸ƒéƒ½ä¼šè¶‹è¿‘äºæ­£æ€åˆ†å¸ƒã€‚
        </p>

        <div class="card">
            <h2>æ ·æœ¬å‡å€¼åˆ†å¸ƒæ¨¡æ‹Ÿ</h2>
            <p class="desc" style="text-align: left; max-width: 100%; margin: 0 0 20px 0;">
                è§‚å¯Ÿä¸åŒåˆ†å¸ƒçš„æ€»ä½“ï¼Œå…¶æ ·æœ¬å‡å€¼åˆ†å¸ƒå¦‚ä½•é€æ¸æ”¶æ•›äºæ­£æ€åˆ†å¸ƒã€‚
            </p>

            <div class="grid-2">
                <div style="display: flex; flex-direction: column;">
                    <h3>æ€»ä½“åˆ†å¸ƒ (Population)</h3>
                    <div class="canvas-container">
                        <canvas id="popChart" height="250"></canvas>
                    </div>
                    <p style="font-size: 0.8rem; margin-top: 10px; color: var(--text-sub);">
                        è¿™æ˜¯ä»æ€»ä½“ä¸­æŠ½å–å•ä¸ªæ ·æœ¬çš„åˆ†å¸ƒå½¢çŠ¶
                    </p>
                </div>

                <div style="display: flex; flex-direction: column;">
                    <h3>æ ·æœ¬å‡å€¼åˆ†å¸ƒ (Sampling Distribution)</h3>
                    <div class="canvas-container">
                        <canvas id="cltChart" height="250"></canvas>
                    </div>
                    <p style="font-size: 0.8rem; margin-top: 10px; color: var(--text-sub);">
                        éšç€æ¨¡æ‹Ÿæ¬¡æ•°å¢åŠ ï¼Œè§‚å¯Ÿé’Ÿå½¢æ›²çº¿çš„å½¢æˆ
                    </p>
                </div>
            </div>

            <div class="controls" style="margin-bottom: 20px;">
                <div class="control-group">
                    <label class="control-label">åŸå§‹åˆ†å¸ƒç±»å‹</label>
                    <select id="distSelect" onchange="changeDistribution()">
                        <option value="uniform">å‡åŒ€åˆ†å¸ƒ (Uniform)</option>
                        <option value="exponential">æŒ‡æ•°åˆ†å¸ƒ (Exponential) - ä¸¥é‡åæ–œ</option>
                        <option value="bimodal">åŒå³°åˆ†å¸ƒ (Bimodal) - ä¸¤ä¸ªæå€¼</option>
                    </select>
                </div>

                <div class="control-group">
                    <label class="control-label">
                        æ ·æœ¬é‡ (N)
                        <span id="nValue" class="value-display">30</span>
                    </label>
                    <input type="range" id="sampleSize" min="1" max="100" value="30" oninput="updateSampleSize()">
                    <small class="help-text">æç¤ºï¼šå¯¹äºåæ–œæˆ–åŒå³°åˆ†å¸ƒï¼Œéœ€è¦æ›´å¤§çš„ N æ‰èƒ½çœ‹åˆ°å®Œç¾çš„é’Ÿå½¢ã€‚</small>
                </div>

                <div class="stats-box" style="flex: 1;">
                    <div class="stat-item">
                        <small>æ¨¡æ‹Ÿæ¬¡æ•°</small>
                        <strong id="simCount">0</strong>
                    </div>
                    <div class="stat-item">
                        <small>æœ€æ–°å‡å€¼</small>
                        <strong id="currentMean">-</strong>
                    </div>
                </div>
            </div>

            <div class="controls">
                <button class="btn-primary" id="startBtn" onclick="toggleSimulation()">â–¶ å¼€å§‹æ¨¡æ‹Ÿ</button>
                <button class="btn-reset" onclick="resetSimulation()">ğŸ”„ é‡ç½®</button>
            </div>
        </div>
    </div>

<script>
    // --- é…ç½®ä¸çŠ¶æ€ ---
    let currentDist = 'uniform';
    let sampleSize = 30;
    let isRunning = false;
    let animationId;

    const binCount = 60;
    const labels = Array.from({length: binCount}, (_, i) => (i / binCount).toFixed(2));

    let histogramData = new Array(binCount).fill(0);
    let totalSimulations = 0;

    // --- Chart.js åˆå§‹åŒ– ---

    // 1. æ€»ä½“åˆ†å¸ƒå›¾è¡¨ (é™æ€å±•ç¤ºå½¢çŠ¶)
    const ctxPop = document.getElementById('popChart').getContext('2d');
    const popChart = new Chart(ctxPop, {
        type: 'line',
        data: {
            labels: labels,
            datasets: [{
                label: 'æ¦‚ç‡å¯†åº¦',
                data: [],
                borderColor: '#64748B',
                backgroundColor: 'rgba(100, 116, 139, 0.2)',
                borderWidth: 2,
                fill: true,
                pointRadius: 0,
                tension: 0.3
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                x: { display: true, ticks: { maxTicksLimit: 10 }, color: '#94A3B8' },
                y: { display: false }
            },
            plugins: { legend: { display: false } },
            animation: { duration: 500 }
        }
    });

    // 2. å‡å€¼åˆ†å¸ƒå›¾è¡¨ (åŠ¨æ€ç´¯ç§¯)
    const ctxCLT = document.getElementById('cltChart').getContext('2d');
    const cltChart = new Chart(ctxCLT, {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [{
                label: 'é¢‘ç‡',
                data: histogramData,
                backgroundColor: 'rgba(16, 185, 129, 0.8)',
                borderRadius: 4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            animation: { duration: 0 },
            scales: {
                x: {
                    display: true,
                    title: {display:true, text: 'å‡å€¼ (0 - 1)', color: '#94A3B8'},
                    ticks: { maxTicksLimit: 10, color: '#94A3B8' }
                },
                y: { display: false }
            },
            plugins: { legend: { display: false } }
        }
    });

    // --- æ•°å­¦ç”Ÿæˆå™¨ ---

    function randn_bm() {
        let u = 0, v = 0;
        while(u === 0) u = Math.random();
        while(v === 0) v = Math.random();
        return Math.sqrt( -2.0 * Math.log( u ) ) * Math.cos( 2.0 * Math.PI * v );
    }

    const generators = {
        uniform: () => Math.random(),

        exponential: () => {
            let val = -Math.log(1 - Math.random()) / 5;
            return val > 1 ? 1 : val;
        },

        bimodal: () => {
            if (Math.random() < 0.5) {
                return 0.2 + randn_bm() * 0.05;
            } else {
                return 0.8 + randn_bm() * 0.05;
            }
        }
    };

    // --- é€»è¾‘æ§åˆ¶ ---

    function updatePopChart() {
        let data = [];
        for(let i=0; i<binCount; i++) {
            let x = i / binCount;
            let y = 0;

            if(currentDist === 'uniform') {
                y = 1;
            } else if (currentDist === 'exponential') {
                y = Math.exp(-5 * x);
            } else if (currentDist === 'bimodal') {
                const g1 = Math.exp(-Math.pow(x - 0.2, 2) / (2 * 0.05 * 0.05));
                const g2 = Math.exp(-Math.pow(x - 0.8, 2) / (2 * 0.05 * 0.05));
                y = g1 + g2;
            }
            data.push(y);
        }
        popChart.data.datasets[0].data = data;
        popChart.data.datasets[0].stepped = (currentDist === 'uniform');
        popChart.update();
    }

    function changeDistribution() {
        currentDist = document.getElementById('distSelect').value;
        resetSimulation();
        updatePopChart();
    }

    function updateSampleSize() {
        sampleSize = parseInt(document.getElementById('sampleSize').value);
        document.getElementById('nValue').innerText = sampleSize;
        resetSimulation();
    }

    function loop() {
        if (!isRunning) return;

        let currentBatchMean = 0;

        for(let k=0; k<50; k++) {
            let sum = 0;
            for(let i=0; i<sampleSize; i++) {
                let val = generators[currentDist]();
                if(val < 0) val = 0;
                if(val > 1) val = 1;
                sum += val;
            }

            let mean = sum / sampleSize;
            currentBatchMean = mean;

            let binIdx = Math.floor(mean * binCount);
            if(binIdx >= binCount) binIdx = binCount - 1;
            histogramData[binIdx]++;
            totalSimulations++;
        }

        document.getElementById('simCount').innerText = totalSimulations.toLocaleString();
        document.getElementById('currentMean').innerText = currentBatchMean.toFixed(4);

        cltChart.update();
        animationId = requestAnimationFrame(loop);
    }

    function toggleSimulation() {
        const btn = document.getElementById('startBtn');
        if (isRunning) {
            isRunning = false;
            btn.innerText = "â–¶ ç»§ç»­æ¨¡æ‹Ÿ";
            cancelAnimationFrame(animationId);
        } else {
            isRunning = true;
            btn.innerText = "â¸ æš‚åœæ¨¡æ‹Ÿ";
            loop();
        }
    }

    function resetSimulation() {
        isRunning = false;
        cancelAnimationFrame(animationId);

        histogramData.fill(0);
        totalSimulations = 0;

        document.getElementById('simCount').innerText = "0";
        document.getElementById('currentMean').innerText = "-";
        document.getElementById('startBtn').innerText = "â–¶ å¼€å§‹æ¨¡æ‹Ÿ";

        cltChart.update();
    }

    updatePopChart();
</script>
</body>
</html>
