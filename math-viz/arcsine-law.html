<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>åæ­£å¼¦å®šå¾‹æ¨¡æ‹Ÿå™¨ - éšæœºæ¸¸èµ°çš„ç›´è§‰é™·é˜±</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --primary: #6366F1; --secondary: #F59E0B; --bg: #0F172A; --card: #1E293B; --text: #F8FAFC; }
        body { font-family: system-ui; background: var(--bg); color: var(--text); padding: 20px; margin: 0; display: flex; flex-direction: column; align-items: center; }
        .container { width: 100%; max-width: 1200px; }
        .card { background: var(--card); border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.3); }
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }
        .canvas-container { position: relative; width: 100%; }
        canvas { width: 100% !important; border-radius: 8px; }
        .controls { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }
        button { padding: 12px 20px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; transition: 0.2s; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-secondary { background: var(--secondary); color: #000; }
        .btn-reset { background: #475569; color: white; }
        select { padding: 10px; border-radius: 8px; border: 2px solid #475569; background: var(--card); color: var(--text); font-size: 14px; cursor: pointer; }
        select:hover { border-color: var(--primary); }
        .control-group { display: flex; gap: 10px; align-items: center; margin-bottom: 15px; }
        .control-label { color: #94A3B8; font-size: 14px; }
        h1 { margin-bottom: 10px; }
        .desc { color: #94A3B8; text-align: center; max-width: 800px; margin: 0 auto 30px; line-height: 1.6; }
        h2 { color: var(--primary); margin-top: 0; border-bottom: 2px solid var(--primary); padding-bottom: 10px; }
        h3 { margin-top: 0; font-size: 1.1rem; }
        .highlight { color: var(--primary); font-weight: bold; }
        .highlight-2 { color: var(--secondary); font-weight: bold; }
    </style>
</head>
<body>

    <div class="container">
        <h1>ğŸ² åæ­£å¼¦å®šå¾‹æ¨¡æ‹Ÿ (Arcsin Law)</h1>
        <p class="desc">
            åæ­£å¼¦å®šå¾‹æ­ç¤ºäº†éšæœºæ¸¸èµ°ä¸­çš„åç›´è§‰ç°è±¡ï¼šç²’å­æ›´å€¾å‘äºæç«¯çŠ¶æ€è€Œéå¹³è¡¡çŠ¶æ€ã€‚<br>
            ä¸‹é¢å±•ç¤ºä¸¤ç§è¡¨ç°å½¢å¼ï¼Œéƒ½å‘ˆç°<b class="highlight">Uå‹åˆ†å¸ƒ</b>ã€‚
        </p>

        <!-- æ¨¡æ‹Ÿä¸€ï¼šæ­£å‘æ—¶é—´å æ¯” -->
        <div class="card">
            <h2>ğŸ“Š æ¨¡æ‹Ÿä¸€ï¼šæ­£å‘æ—¶é—´å æ¯”åˆ†å¸ƒ</h2>
            <p class="desc" style="text-align: left; max-width: 100%; margin: 0 0 20px 0;">
                ç»Ÿè®¡ç²’å­åœ¨<b class="highlight">0è½´ä¸Šæ–¹</b>åœç•™çš„æ—¶é—´å æ¯”ã€‚ç›´è§‰åº”è¯¥åœ¨50%é™„è¿‘ï¼Œä½†å®é™…å‘ˆç°Uå‹åˆ†å¸ƒã€‚
            </p>

            <div class="grid-2">
                <div>
                    <h3>å½“å‰è·¯å¾„æ¨¡æ‹Ÿ (Random Walk)</h3>
                    <div class="canvas-container">
                        <canvas id="walkCanvas" height="250"></canvas>
                    </div>
                    <div style="font-size: 0.85rem; margin-top:10px; color: #94A3B8;">
                        æ­£å‘æ—¶é—´å æ¯”: <span id="currentRatio" style="color:var(--primary); font-weight:bold">0%</span>
                    </div>
                </div>

                <div>
                    <h3>æ­£å‘æ—¶é—´å æ¯”åˆ†å¸ƒ</h3>
                    <div class="canvas-container">
                        <canvas id="distChart" height="250"></canvas>
                    </div>
                </div>
            </div>

            <div class="controls">
                <div class="control-group">
                    <span class="control-label">æ¨¡æ‹Ÿæ¬¡æ•°:</span>
                    <select id="batchSize1" onchange="updateButtonText1()">
                        <option value="100">100 æ¬¡</option>
                        <option value="200">200 æ¬¡</option>
                        <option value="500">500 æ¬¡</option>
                        <option value="1000">1000 æ¬¡</option>
                    </select>
                </div>
                <button class="btn-primary" id="runBtn1" onclick="runBatch1()">è¿è¡Œ 100 æ¬¡å®éªŒ</button>
                <button class="btn-reset" onclick="reset1()">é‡ç½®</button>
            </div>
        </div>

        <!-- æ¨¡æ‹ŸäºŒï¼šæœ€åå›å½’ç‚¹ -->
        <div class="card">
            <h2 style="color: var(--secondary); border-bottom-color: var(--secondary);">ğŸ¯ æ¨¡æ‹ŸäºŒï¼šæœ€åå›å½’ç‚¹åˆ†å¸ƒ</h2>
            <p class="desc" style="text-align: left; max-width: 100%; margin: 0 0 20px 0;">
                ç»Ÿè®¡éšæœºæ¸¸èµ°<b class="highlight-2">æœ€åä¸€æ¬¡ç¢°åˆ°0è½´</b>çš„æ—¶é—´ç‚¹ã€‚è´å¶æ–¯è§†è§’ï¼šè·¯å¾„ä¸€æ—¦ç¦»å¼€0è½´å¤ªä¹…ï¼Œå›å½’çš„"ä¼¼ç„¶æ€§"å°±å˜å¾—æä½ã€‚
            </p>

            <div>
                <h3>æœ€åä¸€æ¬¡å›åˆ°0çš„æ—¶åˆ»åˆ†å¸ƒ</h3>
                <div class="canvas-container">
                    <canvas id="lastZeroChart" height="300"></canvas>
                </div>
            </div>

            <div class="controls">
                <div class="control-group">
                    <span class="control-label">æ¨¡æ‹Ÿæ¬¡æ•°:</span>
                    <select id="batchSize2" onchange="updateButtonText2()">
                        <option value="100">100 æ¬¡</option>
                        <option value="200">200 æ¬¡</option>
                        <option value="500">500 æ¬¡</option>
                        <option value="1000">1000 æ¬¡</option>
                    </select>
                </div>
                <button class="btn-secondary" id="runBtn2" onclick="runBatch2()">è¿è¡Œ 100 æ¬¡å®éªŒ</button>
                <button class="btn-reset" onclick="reset2()">é‡ç½®</button>
            </div>

            <p class="desc" style="text-align: left; max-width: 100%; margin-top: 20px;">
                <b>è§‚å¯Ÿè¦ç‚¹ï¼š</b>ç»å¤§å¤šæ•°è·¯å¾„åœ¨å¾ˆæ—©ï¼ˆæ¯”å¦‚å‰10%æ—¶é—´ï¼‰åå°±<b>å†ä¹Ÿæ²¡æœ‰å›åˆ°è¿‡0ç‚¹</b>ï¼›æˆ–è€…ç›´åˆ°å¿«ç»“æŸæ—¶æ‰æœ€åä¸€æ¬¡è§¦ç¢°0ç‚¹ã€‚è¿™æ­£æ˜¯åæ­£å¼¦å®šå¾‹çš„å¦ä¸€ç§è¡¨ç°ï¼
            </p>
        </div>
    </div>

<script>
    // ==================== æ¨¡æ‹Ÿä¸€ï¼šæ­£å‘æ—¶é—´å æ¯” ====================
    const walkCtx = document.getElementById('walkCanvas').getContext('2d');
    const distCtx = document.getElementById('distChart').getContext('2d');

    let statsData1 = new Array(20).fill(0);
    const steps1 = 500;

    const distChart = new Chart(distCtx, {
        type: 'bar',
        data: {
            labels: Array.from({length: 20}, (_, i) => (i/20).toFixed(2)),
            datasets: [{
                label: 'å‡ºç°æ¬¡æ•°',
                data: statsData1,
                backgroundColor: 'rgba(99, 102, 241, 0.8)',
                borderRadius: 4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: { display: false },
                x: { title: { display: true, text: 'å¤„äºæ­£å€¼åŒºåŸŸçš„æ—¶é—´æ¯”ä¾‹', color: '#94A3B8' } }
            },
            plugins: { legend: { display: false } }
        }
    });

    function drawWalk(path) {
        walkCtx.clearRect(0, 0, walkCtx.canvas.width, walkCtx.canvas.height);
        const scaleX = walkCtx.canvas.width / steps1;
        const scaleY = 2;

        // ç”» 0 è½´
        walkCtx.setLineDash([5, 5]);
        walkCtx.strokeStyle = '#475569';
        walkCtx.beginPath();
        walkCtx.moveTo(0, walkCtx.canvas.height/2);
        walkCtx.lineTo(walkCtx.canvas.width, walkCtx.canvas.height/2);
        walkCtx.stroke();
        walkCtx.setLineDash([]);

        // ç”»è·¯å¾„
        walkCtx.strokeStyle = '#6366F1';
        walkCtx.lineWidth = 2;
        walkCtx.beginPath();
        walkCtx.moveTo(0, walkCtx.canvas.height/2);
        path.forEach((val, i) => {
            walkCtx.lineTo(i * scaleX, walkCtx.canvas.height/2 - val * scaleY);
        });
        walkCtx.stroke();
    }

    function updateButtonText1() {
        const batchSize = document.getElementById('batchSize1').value;
        document.getElementById('runBtn1').innerText = `è¿è¡Œ ${batchSize} æ¬¡å®éªŒ`;
    }

    function runBatch1() {
        const batchSize = parseInt(document.getElementById('batchSize1').value);
        for(let c = 0; c < batchSize; c++) {
            let position = 0;
            let positiveTime = 0;
            let path = [];

            for(let s = 0; s < steps1; s++) {
                position += Math.random() > 0.5 ? 1 : -1;
                path.push(position);
                if(position > 0) positiveTime++;
            }

            const ratio = positiveTime / steps1;
            const bin = Math.min(Math.floor(ratio * 20), 19);
            statsData1[bin]++;

            if(c === batchSize - 1) {
                drawWalk(path);
                document.getElementById('currentRatio').innerText = (ratio * 100).toFixed(1) + '%';
            }
        }
        distChart.update();
    }

    function reset1() {
        statsData1.fill(0);
        distChart.update();
        walkCtx.clearRect(0, 0, walkCtx.canvas.width, walkCtx.canvas.height);
        document.getElementById('currentRatio').innerText = '0%';
    }

    // ==================== æ¨¡æ‹ŸäºŒï¼šæœ€åå›å½’ç‚¹ ====================
    const lastZeroCtx = document.getElementById('lastZeroChart').getContext('2d');
    const binCount2 = 30;
    let statsData2 = new Array(binCount2).fill(0);
    const steps2 = 1000;

    const lastZeroChart = new Chart(lastZeroCtx, {
        type: 'bar',
        data: {
            labels: Array.from({length: binCount2}, (_, i) => (i/binCount2).toFixed(2)),
            datasets: [{
                label: 'æœ€åå›å½’æ—¶åˆ»å‡ºç°çš„é¢‘æ¬¡',
                data: statsData2,
                backgroundColor: '#F59E0B',
                borderRadius: 4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                x: { title: { display: true, text: 'æœ€åä¸€æ¬¡å›åˆ°0çš„æ—¶é—´ç‚¹ (0=å¼€å§‹, 1=ç»“æŸ)', color: '#9CA3AF' } },
                y: { display: false }
            },
            plugins: { legend: { display: false } }
        }
    });

    function updateButtonText2() {
        const batchSize = document.getElementById('batchSize2').value;
        document.getElementById('runBtn2').innerText = `è¿è¡Œ ${batchSize} æ¬¡å®éªŒ`;
    }

    function runBatch2() {
        const batchSize = parseInt(document.getElementById('batchSize2').value);
        for(let i = 0; i < batchSize; i++) {
            let pos = 0;
            let lastZero = 0;
            for(let s = 1; s <= steps2; s++) {
                pos += Math.random() > 0.5 ? 1 : -1;
                if(pos === 0) lastZero = s;
            }
            let ratio = lastZero / steps2;
            let bin = Math.min(Math.floor(ratio * binCount2), binCount2 - 1);
            statsData2[bin]++;
        }
        lastZeroChart.update();
    }

    function reset2() {
        statsData2.fill(0);
        lastZeroChart.update();
    }
</script>
</body>
</html>
