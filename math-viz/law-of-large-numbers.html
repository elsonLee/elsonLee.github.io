<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>å¤§æ•°å®šå¾‹æ¨¡æ‹Ÿ - Law of Large Numbers</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #222;
            --bg: #fff;
            --card: #f9f9f9;
            --text: #222;
            --text-sub: #555;
        }

        body {
            font-family: system-ui;
            background: var(--bg);
            color: var(--text);
            padding: 20px;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .container {
            width: 100%;
            max-width: 1200px;
        }

        .card {
            background: var(--card);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .canvas-container {
            position: relative;
            width: 100%;
        }

        canvas {
            width: 100% !important;
            border-radius: 8px;
        }

        .controls {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        button {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.2s;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-secondary {
            background: #999;
            color: white;
        }

        .btn-danger {
            background: #EF4444;
            color: white;
        }

        select, input[type="range"] {
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #ddd;
            background: #fff;
            color: var(--text);
            font-size: 14px;
            cursor: pointer;
        }

        select:hover, input[type="range"]:hover {
            border-color: var(--primary);
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 15px;
        }

        .control-label {
            color: var(--text-sub);
            font-size: 0.85rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        h1 {
            margin-bottom: 10px;
        }

        .desc {
            color: var(--text-sub);
            text-align: center;
            max-width: 800px;
            margin: 0 auto 30px;
            line-height: 1.6;
        }

        h2 {
            color: var(--primary);
            margin-top: 0;
            border-bottom: 2px solid var(--primary);
            padding-bottom: 10px;
        }

        h3 {
            margin-top: 0;
            font-size: 1.1rem;
            margin-bottom: 15px;
        }

        .stats-box {
            background: #fff;
            border: 1px solid #e0e0e0;
            padding: 1rem;
            border-radius: 8px;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .stat-item small {
            display: block;
            color: var(--text-sub);
            font-size: 0.75rem;
            margin-bottom: 2px;
        }

        .stat-item strong {
            font-size: 1.25rem;
            color: var(--text);
        }

        .value-display {
            float: right;
            color: var(--primary);
            font-family: 'Courier New', monospace;
            font-weight: bold;
        }

        .help-text {
            font-size: 0.75rem;
            color: var(--text-sub);
            margin-top: 4px;
            line-height: 1.4;
        }

        .full-width {
            grid-column: 1 / -1;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>ğŸ² å¤§æ•°å®šå¾‹ (Law of Large Numbers)</h1>
        <p class="desc">
            æ¨¡æ‹ŸæŠ›ç¡¬å¸å®éªŒï¼Œè§‚å¯Ÿéšç€è¯•éªŒæ¬¡æ•°å¢åŠ ï¼Œæ ·æœ¬é¢‘ç‡å¦‚ä½•æ”¶æ•›äºç†è®ºæ¦‚ç‡ã€‚<br>
            è¿™æ˜¯æ¦‚ç‡è®ºä¸­æœ€åŸºæœ¬çš„å®šç†ä¹‹ä¸€ï¼Œæ­ç¤ºäº†é¢‘ç‡ç¨³å®šæ€§ã€‚
        </p>

        <div class="card">
            <h2>é¢‘ç‡æ”¶æ•›æ¨¡æ‹Ÿ</h2>
            <p class="desc" style="text-align: left; max-width: 100%; margin: 0 0 20px 0;">
                è§‚å¯Ÿæ­£é¢æœä¸Šçš„é¢‘ç‡å¦‚ä½•éšç€æŠ•æ·æ¬¡æ•°å¢åŠ è€Œé€æ¸æ”¶æ•›äºç†è®ºæ¦‚ç‡ã€‚
            </p>

            <div class="grid-2">
                <div class="full-width">
                    <h3>é¢‘ç‡æ”¶æ•›æ›²çº¿</h3>
                    <div class="canvas-container">
                        <canvas id="llnChart" height="300"></canvas>
                    </div>
                </div>
            </div>

            <div class="stats-box">
                <div class="stat-item">
                    <small>æ€»æŠ•æ·æ¬¡æ•°</small>
                    <strong id="totalCount">0</strong>
                </div>
                <div class="stat-item">
                    <small>æ­£é¢æ¬¡æ•°</small>
                    <strong id="headsCount">0</strong>
                </div>
                <div class="stat-item">
                    <small>åé¢æ¬¡æ•°</small>
                    <strong id="tailsCount">0</strong>
                </div>
                <div class="stat-item">
                    <small>å½“å‰é¢‘ç‡</small>
                    <strong id="frequency">0.0000</strong>
                </div>
                <div class="stat-item">
                    <small>ç†è®ºæ¦‚ç‡</small>
                    <strong id="theoreticalProb">0.5000</strong>
                </div>
                <div class="stat-item">
                    <small>ç»å¯¹åå·®</small>
                    <strong id="deviation">0.0000</strong>
                </div>
            </div>

            <div class="controls" style="margin-bottom: 20px;">
                <div class="control-group">
                    <label class="control-label">
                        æ­£é¢æ¦‚ç‡ (P)
                        <span id="probabilityValue" class="value-display">0.50</span>
                    </label>
                    <input type="range" id="probabilitySlider" min="0.1" max="0.9" step="0.05" value="0.5">
                    <small class="help-text">è°ƒæ•´ç¡¬å¸å‡ºç°æ­£é¢çš„ç†è®ºæ¦‚ç‡</small>
                </div>

                <div class="control-group">
                    <label class="control-label">æ¨¡æ‹Ÿé€Ÿåº¦</label>
                    <select id="speedSelect">
                        <option value="1">æ…¢é€Ÿ (1æ¬¡/å¸§)</option>
                        <option value="5" selected>ä¸­é€Ÿ (5æ¬¡/å¸§)</option>
                        <option value="20">å¿«é€Ÿ (20æ¬¡/å¸§)</option>
                        <option value="100">æé€Ÿ (100æ¬¡/å¸§)</option>
                    </select>
                </div>
            </div>

            <div class="controls">
                <button class="btn-primary" id="startBtn" onclick="toggleSimulation()">â–¶ å¼€å§‹æ¨¡æ‹Ÿ</button>
                <button class="btn-secondary" onclick="flipBatch(100)">+100 æ¬¡</button>
                <button class="btn-secondary" onclick="flipBatch(1000)">+1,000 æ¬¡</button>
                <button class="btn-secondary" onclick="flipBatch(10000)">+10,000 æ¬¡</button>
                <button class="btn-secondary" onclick="resetSimulation()">ğŸ”„ é‡ç½®</button>
            </div>
        </div>

        <div class="card">
            <h2>ğŸ“š å…³äºå¤§æ•°å®šå¾‹</h2>
            <div style="color: var(--text); line-height: 1.8;">
                <p><strong>å¤§æ•°å®šå¾‹ï¼ˆLaw of Large Numbers, LLNï¼‰</strong>æ˜¯æ¦‚ç‡è®ºä¸­çš„ä¸€æ¡åŸºæœ¬å®šç†ï¼Œæè¿°äº†éšæœºè¯•éªŒæ¬¡æ•°å¢å¤šæ—¶ï¼Œäº‹ä»¶å‘ç”Ÿçš„é¢‘ç‡ä¼šè¶‹è¿‘äºå…¶æ¦‚ç‡ã€‚</p>

                <h3 style="color: var(--primary); margin-top: 20px;">æ•°å­¦è¡¨è¾¾ï¼š</h3>
                <p>è®¾ Xâ‚, Xâ‚‚, ..., Xâ‚™ æ˜¯ç‹¬ç«‹åŒåˆ†å¸ƒçš„éšæœºå˜é‡ï¼ŒæœŸæœ›å€¼ä¸º Î¼ï¼Œåˆ™å¯¹äºä»»æ„ Îµ > 0ï¼š</p>
                <pre style="background: #f5f5f5; padding: 12px; border-radius: 8px; overflow-x: auto; margin: 8px 0; border: 1px solid #e0e0e0;">lim(nâ†’âˆ) P(|XÌ„â‚™ - Î¼| < Îµ) = 1</pre>

                <h3 style="color: var(--primary); margin-top: 20px;">ä¸¤ç§å½¢å¼ï¼š</h3>
                <ul style="padding-left: 20px;">
                    <li><strong>å¼±å¤§æ•°å®šå¾‹ï¼ˆè¾›é’¦å®šå¾‹ï¼‰</strong>ï¼šæ ·æœ¬å‡å€¼ä¾æ¦‚ç‡æ”¶æ•›äºæœŸæœ›å€¼</li>
                    <li><strong>å¼ºå¤§æ•°å®šå¾‹ï¼ˆæŸ¯å°”è«å“¥æ´›å¤«å®šå¾‹ï¼‰</strong>ï¼šæ ·æœ¬å‡å€¼å‡ ä¹å¿…ç„¶æ”¶æ•›äºæœŸæœ›å€¼</li>
                </ul>

                <h3 style="color: var(--primary); margin-top: 20px;">å®é™…åº”ç”¨ï¼š</h3>
                <ul style="padding-left: 20px;">
                    <li>ä¿é™©å…¬å¸çš„é£é™©è¯„ä¼°ï¼ˆåŸºäºå¤§é‡å®¢æˆ·æ•°æ®ï¼‰</li>
                    <li>è´¨é‡æ§åˆ¶ä¸­çš„æŠ½æ ·æ£€éªŒ</li>
                    <li>æ°‘æ„è°ƒæŸ¥çš„æ ·æœ¬é‡ç¡®å®š</li>
                    <li>èµŒåœºå’Œåšå½©ä¸šçš„ç›ˆåˆ©ä¿è¯</li>
                </ul>
            </div>
        </div>
    </div>

<script>
    // --- é…ç½®ä¸çŠ¶æ€ ---
    const simulation = {
        total: 0,
        heads: 0,
        tails: 0,
        probability: 0.5,
        isRunning: false,
        speed: 5,
        animationId: null,
        chart: null,
        maxDataPoints: 500,
        sampleInterval: 1
    };

    // --- Chart.js åˆå§‹åŒ– ---
    const ctx = document.getElementById('llnChart').getContext('2d');
    simulation.chart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: [],
            datasets: [
                {
                    label: 'æ­£é¢é¢‘ç‡',
                    data: [],
                    borderColor: '#4F46E5',
                    backgroundColor: 'rgba(79, 70, 229, 0.1)',
                    borderWidth: 2,
                    pointRadius: 0,
                    fill: true,
                    tension: 0.4
                },
                {
                    label: 'ç†è®ºæ¦‚ç‡',
                    data: [],
                    borderColor: '#10B981',
                    backgroundColor: 'transparent',
                    borderWidth: 2,
                    borderDash: [5, 5],
                    pointRadius: 0,
                    fill: false,
                    tension: 0
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            animation: { duration: 0 },
            scales: {
                x: {
                    display: true,
                    title: {display: true, text: 'æŠ•æ·æ¬¡æ•° (n)', color: '#94A3B8'},
                    ticks: { maxTicksLimit: 10, color: '#94A3B8' }
                },
                y: {
                    display: true,
                    title: {display: true, text: 'é¢‘ç‡ (P)', color: '#94A3B8'},
                    min: 0,
                    max: 1,
                    ticks: { color: '#94A3B8' }
                }
            },
            plugins: {
                legend: {
                    display: true,
                    position: 'top',
                    labels: {
                        usePointStyle: true,
                        padding: 15,
                        color: '#F8FAFC'
                    }
                }
            }
        }
    });

    // --- æ ¸å¿ƒé€»è¾‘ ---

    function adjustSamplingStrategy() {
        if (simulation.total < 100) {
            simulation.sampleInterval = 1;
        } else if (simulation.total < 1000) {
            simulation.sampleInterval = 5;
        } else if (simulation.total < 10000) {
            simulation.sampleInterval = 50;
        } else if (simulation.total < 100000) {
            simulation.sampleInterval = 500;
        } else {
            simulation.sampleInterval = 5000;
        }
    }

    function flipCoin() {
        simulation.total++;
        if (Math.random() < simulation.probability) {
            simulation.heads++;
        } else {
            simulation.tails++;
        }
    }

    function flipBatch(count) {
        for (let i = 0; i < count; i++) {
            flipCoin();
        }
        updateUI();
        updateChart();
    }

    function updateChart() {
        const freq = simulation.total === 0 ? 0 : simulation.heads / simulation.total;
        adjustSamplingStrategy();

        if (simulation.total % simulation.sampleInterval === 0) {
            simulation.chart.data.labels.push(simulation.total);
            simulation.chart.data.datasets[0].data.push(freq);
            simulation.chart.data.datasets[1].data.push(simulation.probability);
        }

        if (simulation.chart.data.labels.length > simulation.maxDataPoints) {
            simulation.chart.data.labels.shift();
            simulation.chart.data.datasets[0].data.shift();
            simulation.chart.data.datasets[1].data.shift();
        }

        simulation.chart.update('none');
    }

    function updateUI() {
        const freq = simulation.total === 0 ? 0 : simulation.heads / simulation.total;
        const deviation = Math.abs(freq - simulation.probability);

        document.getElementById('totalCount').textContent = simulation.total.toLocaleString();
        document.getElementById('headsCount').textContent = simulation.heads.toLocaleString();
        document.getElementById('tailsCount').textContent = simulation.tails.toLocaleString();
        document.getElementById('frequency').textContent = freq.toFixed(4);
        document.getElementById('deviation').textContent = deviation.toFixed(4);

        // æ ¹æ®åå·®æ”¹å˜é¢œè‰²
        const deviationElement = document.getElementById('deviation');
        if (deviation < 0.01) {
            deviationElement.style.color = '#10B981';
        } else if (deviation < 0.05) {
            deviationElement.style.color = '#F59E0B';
        } else {
            deviationElement.style.color = '#EF4444';
        }
    }

    function animate() {
        if (!simulation.isRunning) return;

        for (let i = 0; i < simulation.speed; i++) {
            flipCoin();
        }

        updateUI();
        updateChart();
        simulation.animationId = requestAnimationFrame(animate);
    }

    function toggleSimulation() {
        const btn = document.getElementById('startBtn');
        if (simulation.isRunning) {
            simulation.isRunning = false;
            btn.textContent = 'â–¶ ç»§ç»­æ¨¡æ‹Ÿ';
            btn.classList.remove('btn-danger');
            cancelAnimationFrame(simulation.animationId);
        } else {
            simulation.isRunning = true;
            btn.textContent = 'â¸ æš‚åœæ¨¡æ‹Ÿ';
            btn.classList.add('btn-danger');
            animate();
        }
    }

    function resetSimulation() {
        simulation.isRunning = false;
        if (simulation.animationId) {
            cancelAnimationFrame(simulation.animationId);
        }

        simulation.total = 0;
        simulation.heads = 0;
        simulation.tails = 0;

        simulation.chart.data.labels = [];
        simulation.chart.data.datasets[0].data = [];
        simulation.chart.data.datasets[1].data = [];
        simulation.chart.update();

        document.getElementById('startBtn').textContent = 'â–¶ å¼€å§‹æ¨¡æ‹Ÿ';
        document.getElementById('startBtn').classList.remove('btn-danger');
        updateUI();
    }

    function updateProbability(value) {
        simulation.probability = parseFloat(value);
        document.getElementById('probabilityValue').textContent = simulation.probability.toFixed(2);
        document.getElementById('theoreticalProb').textContent = simulation.probability.toFixed(4);

        if (simulation.chart.data.datasets[1].data.length > 0) {
            simulation.chart.data.datasets[1].data = simulation.chart.data.datasets[1].data.map(() => simulation.probability);
            simulation.chart.update('none');
        }
    }

    function updateSpeed(value) {
        simulation.speed = parseInt(value);
    }

    // --- äº‹ä»¶ç»‘å®š ---
    document.getElementById('probabilitySlider').addEventListener('input', (e) => {
        updateProbability(e.target.value);
    });

    document.getElementById('speedSelect').addEventListener('change', (e) => {
        updateSpeed(e.target.value);
    });

    // åˆå§‹åŒ–UI
    updateUI();
</script>
</body>
</html>
