# CLAUDE.md - 项目开发指南

本文文件包含 AI 助手（Claude）在开发本项目时应遵守的规范和要求。

## 项目概述

**项目名称**: 统计数学定理可视化模拟 (Math Visualization)

**项目目标**: 创建一个交互式的统计数学定理可视化项目，通过动态模拟帮助理解统计学中的核心概念与定理。

**技术栈**: 纯原生 HTML + CSS + JavaScript (无框架)

**部署平台**: GitHub Pages (elsonLee.github.io)

**项目路径**: `~/Project/git_repo/elsonLee.github.io/math-viz/`

## 核心原则

### 1. 技术栈约束
- ✅ **必须使用**: 原生 HTML5, CSS3, JavaScript (ES6+)
- ✅ **允许使用的第三方库**:
  - Chart.js (数据可视化，通过 CDN 引入)
  - 未来可能需要的其他数学/可视化库（需评估必要性）
- ❌ **禁止使用**:
  - 任何前端框架 (React, Vue, Angular, etc.)
  - 任何构建工具 (Webpack, Vite, etc.)
  - 任何 CSS 框架 (Bootstrap, Tailwind, etc. - 除非作为 CSS 变量参考)

### 2. 项目架构

**目录结构**:
```
math-viz/
├── index.html                      # 主页（定理目录）
├── [theorem-name].html            # 各个定理的模拟页面
├── README.md                       # 项目文档
├── CLAUDE.md                       # 本文件
├── css/
│   ├── variables.css              # CSS 变量定义（设计 tokens）
│   └── common.css                 # 通用样式组件
├── js/
│   ├── common.js                  # 通用工具函数库
│   ├── export.js                  # 导出功能模块
│   └── [theorem-name].js         # 各个定理的模拟逻辑
└── lib/                           # 第三方库（可选本地化）
```

**文件命名规范**:
- HTML 文件: 小写字母 + 连字符 (如 `law-of-large-numbers.html`)
- CSS 文件: 小写字母 + 连字符
- JavaScript 文件: 小写字母 + 连字符
- 必须与 HTML 页面名称对应

### 3. 代码风格规范

#### JavaScript
- 使用 ES6+ 语法 (const/let, 箭头函数, 模板字符串等)
- 使用 JSDoc 风格的函数注释
- 函数命名: 动词开头，驼峰命名法
- 变量命名: 有意义的名称，避免缩写
- 使用严格模式: `'use strict'` (在模块作用域中自动启用)

示例:
```javascript
/**
 * 执行单次抛硬币试验
 * @returns {boolean} true 表示正面，false 表示反面
 */
function flipCoin() {
    return Math.random() < simulation.probability;
}
```

#### CSS
- 优先使用 CSS 变量（在 variables.css 中定义）
- 使用 BEM 命名规范或语义化类名
- 避免深层嵌套（最多 2-3 层）
- 响应式设计优先（移动优先）

示例:
```css
.stat-item {
    border-left: 4px solid var(--primary-color);
    padding-left: var(--spacing-md);
}

.stat-label {
    font-size: var(--font-size-sm);
    color: var(--text-sub);
}
```

#### HTML
- 使用语义化标签
- 合理的标题层级 (h1 > h2 > h3)
- 为交互元素提供 aria 标签（如需要）
- 保持一致的缩进（2 或 4 空格）

### 4. 性能要求

**图表性能优化**（必须实现）:
- 动态采样策略: 根据数据量调整采样间隔
- 滚动窗口: 限制最大数据点数（建议 500-1000）
- Chart.js 配置:
  ```javascript
  animation: { duration: 0 }  // 禁用动画
  update: 'none'              // 使用高效更新模式
  ```

**代码优化**:
- 使用 `requestAnimationFrame` 进行动画
- 批量 DOM 操作
- 防抖/节流用户输入
- LocalStorage 状态持久化

### 5. 用户体验标准

**每个定理模拟页面必须包含**:
1. 面包屑导航（返回主页）
2. 清晰的页面标题和描述
3. 实时统计数据展示
4. 可调参数面板
5. 控制按钮（开始/暂停/重置/批量操作）
6. 数据可视化图表
7. 导出功能（图表 + 数据）
8. 理论说明（数学表达 + 实际应用）

**交互反馈**:
- 使用 Toast 提示（`utils.showToast()`）
- 按钮状态变化（开始 → 暂停）
- 加载状态指示（如需要）
- 颜色编码（如偏差值: 绿/橙/红）

### 6. 响应式设计

**断点**:
- 移动端: < 768px
- 平板: 768px - 1024px
- 桌面: > 1024px

**布局适配**:
- 桌面: 两列布局（控制面板 + 图表）
- 移动: 单列布局，图表自适应高度
- 触摸友好的按钮尺寸（最小 44x44px）

### 7. 可维护性要求

**模块化设计**:
- 工具函数放在 `common.js`
- 可复用的组件逻辑抽离
- 单一职责原则

**代码复用**:
- 优先使用 `utils` 对象中的工具函数
- 导出功能统一使用 `exportTools` 对象
- 图表创建参考现有模板

**注释要求**:
- 每个函数必须有 JSDoc 注释
- 复杂逻辑需要行内注释说明
- 数学公式需要注释解释

### 8. 导出功能规范

**必须实现的导出选项**:
1. 📊 导出图表为 PNG 图片
2. 📁 导出数据为 CSV 文件
3. ⚙️ 导出配置为 JSON（可选）

**CSV 格式要求**:
- 使用 UTF-8 BOM 编码（支持中文）
- 包含数据摘要（统计信息）
- 清晰的表头
- 合理的数据格式化

### 9. 状态管理规范

**需要持久化的状态**:
- 模拟器核心数据（总数、成功数等）
- 用户设置的参数
- 图表数据（可选，考虑大小）

**实现方式**:
- 使用 `utils.storage` 对象
- 页面卸载前自动保存
- 提供恢复确认对话框

### 10. 测试与验证

**功能测试清单**:
- [ ] 所有按钮正常工作
- [ ] 参数调整实时生效
- [ ] 图表正确更新
- [ ] 响应式布局正常
- [ ] 导出功能可用
- [ ] 状态保存/恢复
- [ ] 浏览器兼容性（Chrome, Firefox, Safari）

**性能验证**:
- [ ] 大数据量不卡顿（10,000+ 次试验）
- [ ] 动画流畅（60fps）
- [ ] 内存使用合理

### 11. 文档要求

**代码内文档**:
- 函数注释（JSDoc）
- 复杂算法说明
- 数学公式解释

**README.md 更新**:
- 新增定理的介绍
- 使用方法更新
- 技术实现说明

### 12. Git 提交规范

**Commit 消息格式**:
```
类型(范围): 简短描述

详细描述（可选）
```

类型:
- feat: 新功能
- fix: 修复 bug
- docs: 文档更新
- style: 代码格式调整
- refactor: 重构
- perf: 性能优化
- test: 测试相关

示例:
```
feat(law-of-large-numbers): 实现动态采样策略

根据数据量自动调整采样间隔，提升大数据量下的性能
```

## 开发新定理的流程

当需要添加新的定理模拟时，按以下步骤进行：

1. **规划阶段**
   - 确定定理的核心概念和可视化方式
   - 设计可调参数
   - 规划统计数据展示

2. **创建文件**
   - 复制现有 HTML 模板（如 `law-of-large-numbers.html`）
   - 创建对应的 JavaScript 文件
   - 更新主页（`index.html`）添加定理卡片

3. **实现逻辑**
   - 在 JS 文件中定义 `simulation` 对象
   - 实现核心模拟函数
   - 集成 Chart.js 图表
   - 添加交互控制

4. **复用工具**
   - 使用 `common.js` 中的工具函数
   - 使用 `export.js` 实现导出
   - 遵循 CSS 变量系统

5. **测试优化**
   - 功能测试
   - 性能优化（采样策略等）
   - 响应式测试
   - 浏览器兼容性测试

6. **文档更新**
   - 更新 README.md
   - 添加代码注释
   - 更新项目总结（如需要）

## 常见任务指南

### 修改颜色主题
编辑 `css/variables.css` 中的 CSS 变量，所有使用该变量的地方会自动更新。

### 添加新的工具函数
在 `js/common.js` 中添加，并挂载到 `window.utils` 对象上。

### 调整图表样式
修改对应 JS 文件中的 Chart.js 配置对象。

### 修复 bug
1. 先定位问题（HTML/CSS/JS）
2. 使用浏览器开发者工具调试
3. 修复后测试所有相关功能
4. 更新文档（如需要）

## 技术债务和已知限制

**当前限制**:
- Chart.js 通过 CDN 加载（需要网络连接）
- 本地不支持 IE 浏览器
- 大数据量时仍需要权衡性能和精度

**未来改进**:
- 考虑添加 Web Worker 进行后台计算
- 考虑添加单元测试
- 考虑支持离线使用（本地化 Chart.js）

## 联系与反馈

- 项目维护者: elsonLee
- GitHub: https://github.com/elsonLee/elsonLee.github.io
- 问题反馈: GitHub Issues

## 版本历史

- v1.0.0 (2025-01-10): 初始版本，完成大数定律模拟
  - 实现通用工具库和导出系统
  - 建立响应式设计框架
  - 创建主页和文档

---

**重要**: 本文件是项目的"活文档"，随着项目发展应持续更新。在进行重大架构调整或添加新功能时，请先更新本文件。
